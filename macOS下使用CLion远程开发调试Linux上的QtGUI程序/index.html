<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
<title>macOS下使用CLion远程开发调试Linux上的QtGUI程序 | 三日</title>



<meta property="og:title" content="macOS下使用CLion远程开发调试Linux上的QtGUI程序">



<meta name="author" content="sanri">


<meta property="og:locale" content="zh_CH">


<meta name="description" content="三日的笔记">
<meta property="og:description" content="三日的笔记">



<link rel="canonical" href="https://engtang.net/macOS下使用CLion远程开发调试Linux上的QtGUI程序/">
<meta property="og:url" content="https://engtang.net/macOS下使用CLion远程开发调试Linux上的QtGUI程序/">



<meta property="og:site_name" content="三日" />



  <meta property="og:image" content="https://engtang.net/tale.png">
  
  



  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2018-11-02T21:08:49+08:00">



  <link rel="prev" href="https://engtang.net/Windows中使用Qt5.9.0静态库构建应用/">





  <meta name="twitter:card" content="summary_large_image"">
  <meta property="twitter:image" content="https://engtang.net/tale.png">



  <meta property="twitter:title" content="macOS下使用CLion远程开发调试Linux上的QtGUI程序">





  

  

  



  

  

  

  

  


<script type="application/ld+json">
{
  "author": {
    "@type":"Person",
	  "name":"sanri",
  },
  "description": "三日的笔记",
  "url": "https://engtang.net/macOS下使用CLion远程开发调试Linux上的QtGUI程序/",
  "@context":"https://schema.org",
  "@type": "BlogPosting",
  "headline": "macOS下使用CLion远程开发调试Linux上的QtGUI程序"
  
    
    
      "datePublished":"2018-11-02T21:08:49+08:00",
    
    "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://engtang.net/macOS下使用CLion远程开发调试Linux上的QtGUI程序/"
    },
  
}
</script>

  <link rel="stylesheet" href="https://engtang.net/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">

  <link rel="icon" type="image/png" sizes="32x32" href="https://engtang.net/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://engtang.net/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://engtang.net/assets/apple-touch-icon.png">

  
    <link type="application/atom+xml" rel="alternate" href="https://engtang.net/rss.xml" title="三日" />
  

  

  
  
</head>

<body>
  
  <nav class="nav">
    <div class="nav-container">
      <a href="https://engtang.net">
        <h2 class="nav-title">三日</h2>
      </a>
      <ul>
        
          
            <li><a href="https://engtang.net">Posts</a></li>
          
            <li><a href="https://engtang.net/tags">Tags</a></li>
          
            <li><a href="https://engtang.net/about">About</a></li>
          
        
      </ul>
    </div>
  </nav>
  

  <main>
    
  <div class="post">
  	<div class="post-info">
  		<span>Written by</span> sanri<br>
  		<span>On&nbsp;</span><time datetime="2018-11-02T21:08:49+08:00">2018-11-02</time>
  	</div>
  	<h1 class="post-title">macOS下使用CLion远程开发调试Linux上的QtGUI程序</h1>
  	<div class="post-line"></div>
  	<p>在macOS下使用CLion集成开发环境,配合macOS的X11环境XQuartz, 实现在macOS下编码,调试. 在远程Linux主机上编译,运行Qt程序.  并通过SSH的X11转发功能在macOS上显示程序界面.</p>
<span id="continue-reading"></span>
<p>由于需要开发Linux下的GUI程序,但是又不喜欢使用Linux的桌面环境, 适逢CLion2018.3新增远程开发功能,尝试了一下,嗯,可以远程构建并调试QtGUI程序.</p>
<blockquote>
<p>开发环境<br />
macOS 10.14.1 :  XQuartz 2.7.11,  CLion 2018.3, Qt5.9.7<br />
Ubuntu Server 18.04 :  gcc/g++ 7.3.0, gdb 8.1, Qt 5.9.5, cmake 3.10</p>
</blockquote>
<h1 id="实现原理"><a class="zola-anchor" href="#实现原理"  aria-label="Anchor link for: 实现原理">⋅ </a>实现原理</h1>
<p>CLion在2018.3版中新增了远程开发功能(这个功能都被呼吁好几年了,现在终于补上了).虽然按照<a href="https://blog.jetbrains.com/clion/2018/09/initial-remote-dev-support-clion/">官方说明</a>就可以开发一般的控制台程序了,但是还不能直接开发GUI程序.</p>
<p>因为CLion与目标系统间的连接,并没有进行X11转发,所以理论上只需要配置好X11转发通道,再提供一个X11 Server,就能显示GUI程序了.</p>
<p>首先macOS下有XQuartz程序,这样X11 Server有了.</p>
<p>然后在macOS下的控制台,使用ssh程序登录目标Linux系统(带 -X 选项),这样就有了X11转发通道.</p>
<p>最后在CLion中配置项目,在启动目标Linux系统上的程序时,提供X11 Server的地址(程序通过环境变量DISPLAY获取X11 Server地址),这样就可以成功启动并调试目标程序啦.</p>
<h1 id="准备开发环境"><a class="zola-anchor" href="#准备开发环境"  aria-label="Anchor link for: 准备开发环境">⋅ </a>准备开发环境</h1>
<h2 id="macOS"><a class="zola-anchor" href="#macOS"  aria-label="Anchor link for: macOS">⋅ </a>macOS</h2>
<ol>
<li>
<p>安装<a href="https://www.jetbrains.com/clion/">CLion 2018.3</a> 
CLion 的 <a href="https://blog.jetbrains.com/clion/2018/09/initial-remote-dev-support-clion/">远程构建</a> 功能是2018.3版本新加入的, <a href="https://www.jetbrains.com/help/clion/remote-debug.html">远程调试</a> 功能比较早就实现了, 不过这次没有使用老版本的远程调试功能.</p>
</li>
<li>
<p>安装<a href="https://www.xquartz.org/">XQuartz</a> 
最新版本是2.8.1.</p>
</li>
<li>
<p>安装<a href="https://engtang.net/macOS%E4%B8%8B%E4%BD%BF%E7%94%A8CLion%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95Linux%E4%B8%8A%E7%9A%84QtGUI%E7%A8%8B%E5%BA%8F/qt.io">Qt</a>
主要是需要使用 Qt Designer 工具, 不使用工具,手写 ui 文件也可以.</p>
</li>
</ol>
<h2 id="Ubuntu"><a class="zola-anchor" href="#Ubuntu"  aria-label="Anchor link for: Ubuntu">⋅ </a>Ubuntu</h2>
<ol>
<li>安装构建工具</li>
</ol>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo</span><span> apt install gcc g++ gdb cmake
</span></code></pre>
<ol start="2">
<li>安装Qt</li>
</ol>
<pre data-lang="bash" style="background-color:#eff1f5;color:#4f5b66;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo</span><span> apt install qtbase5-dev qt5-default qtdeclarative5-dev qttools5-dev 
</span></code></pre>
<br>
<h1 id="创建项目"><a class="zola-anchor" href="#创建项目"  aria-label="Anchor link for: 创建项目">⋅ </a>创建项目</h1>
<ol>
<li>
<p>首先建立一个C++项目,使用C++11标准.<br />
<br></p>
</li>
<li>
<p>新建 qttest.h, qttest.cpp 文件.</p>
<pre data-lang="cpp" style="background-color:#eff1f5;color:#4f5b66;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span style="color:#a7adba;">// qttest.h
</span><span style="color:#b48ead;">#ifndef</span><span> QT_TEST_H
</span><span style="color:#b48ead;">#define </span><span>QT_TEST_H
</span><span>
</span><span style="color:#b48ead;">#include </span><span>&lt;</span><span style="color:#a3be8c;">QWidget</span><span>&gt;
</span><span style="color:#b48ead;">#include </span><span>&quot;</span><span style="color:#a3be8c;">ui_qttest.h</span><span>&quot;
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#d08770;">qttest </span><span style="color:#343d46;">: </span><span style="color:#b48ead;">public  </span><span style="color:#a3be8c;">QWidget
</span><span style="color:#343d46;">{
</span><span style="color:#343d46;">    Q_OBJECT
</span><span style="color:#b48ead;">public</span><span style="color:#343d46;">:
</span><span style="color:#343d46;">    </span><span style="color:#8fa1b3;">qttest</span><span style="color:#343d46;">(QWidget </span><span>*</span><span style="color:#bf616a;">parent </span><span>= </span><span style="color:#d08770;">0</span><span style="color:#343d46;">);
</span><span style="color:#343d46;">    </span><span style="color:#8fa1b3;">~qttest</span><span style="color:#343d46;">();
</span><span style="color:#b48ead;">private</span><span style="color:#343d46;">:
</span><span style="color:#343d46;">    Ui::qttest_ui ui;
</span><span style="color:#343d46;">}</span><span>;
</span><span>
</span><span style="color:#b48ead;">#endif </span><span style="color:#a7adba;">// QT_TEST_H
</span></code></pre>
<pre data-lang="cpp" style="background-color:#eff1f5;color:#4f5b66;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span style="color:#a7adba;">// qttest.cpp  
</span><span style="color:#b48ead;">#include </span><span>&quot;</span><span style="color:#a3be8c;">qttest.h</span><span>&quot;
</span><span>
</span><span>qttest::</span><span style="color:#8fa1b3;">qttest</span><span>(QWidget *</span><span style="color:#bf616a;">parent</span><span>) : </span><span style="color:#bf616a;">QWidget</span><span>(parent)
</span><span>{
</span><span>    ui.</span><span style="color:#bf616a;">setupUi</span><span>(</span><span style="color:#bf616a;">this</span><span>);
</span><span>}
</span><span>
</span><span>qttest::</span><span style="color:#8fa1b3;">~qttest</span><span>()
</span><span>{
</span><span>
</span><span>}
</span></code></pre>
<br>
</li>
<li>
<p>使用 <strong>Qt Designer</strong> 程序新建 qttest.ui文件,注意窗口对象的名称需要与 qttest.h 中ui对象的类型名一致    <img src="https://engtang.net/macOS%E4%B8%8B%E4%BD%BF%E7%94%A8CLion%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95Linux%E4%B8%8A%E7%9A%84QtGUI%E7%A8%8B%E5%BA%8F/qt-designer-widget.jpg" alt="" /></p>
</li>
<li>
<p>改写 main.cpp 文件</p>
<pre data-lang="cpp" style="background-color:#eff1f5;color:#4f5b66;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span style="color:#b48ead;">#include </span><span>&quot;</span><span style="color:#a3be8c;">qttest.h</span><span>&quot;
</span><span style="color:#b48ead;">#include </span><span>&lt;</span><span style="color:#a3be8c;">QtWidgets/QApplication</span><span>&gt;
</span><span>
</span><span style="color:#b48ead;">int </span><span style="color:#8fa1b3;">main</span><span>(</span><span style="color:#b48ead;">int </span><span style="color:#bf616a;">argc</span><span>, </span><span style="color:#b48ead;">char </span><span>*</span><span style="color:#bf616a;">argv</span><span>[])
</span><span>{
</span><span>    QApplication </span><span style="color:#bf616a;">a</span><span>(argc, argv);
</span><span>    qttest w;
</span><span>    w.</span><span style="color:#bf616a;">show</span><span>();
</span><span>    </span><span style="color:#b48ead;">return</span><span> a.</span><span style="color:#bf616a;">exec</span><span>();
</span><span>}
</span></code></pre>
<br>
</li>
<li>
<p>编辑 CMakeLists.txt 文件</p>
<pre data-lang="cmake" style="background-color:#eff1f5;color:#4f5b66;" class="language-cmake "><code class="language-cmake" data-lang="cmake"><span style="color:#96b5b4;">cmake_minimum_required</span><span>(</span><span style="color:#bf616a;">VERSION </span><span>3.10)
</span><span style="color:#96b5b4;">set</span><span>(</span><span style="color:#bf616a;">CMAKE_CXX_STANDARD </span><span>11)
</span><span>
</span><span style="color:#a7adba;"># 自动将当前源代码和构建目录添加到包含路径
</span><span style="color:#96b5b4;">set</span><span>(</span><span style="color:#bf616a;">CMAKE_INCLUDE_CURRENT_DIR </span><span>ON)
</span><span style="color:#a7adba;"># 指示CMake在需要时自动运行moc
</span><span style="color:#96b5b4;">set</span><span>(</span><span style="color:#bf616a;">CMAKE_AUTOMOC </span><span>ON)
</span><span>
</span><span style="color:#a7adba;"># 兼容macOS下构建
</span><span style="color:#b48ead;">if</span><span>(APPLE)
</span><span>    </span><span style="color:#96b5b4;">message</span><span>(&quot;</span><span style="color:#a3be8c;">apple</span><span style="color:#96b5b4;">\n</span><span>&quot;)
</span><span>    </span><span style="color:#96b5b4;">set</span><span>(</span><span style="color:#bf616a;">CMAKE_PREFIX_PATH </span><span>/Users/tang/Qt/5.9.7/clang_64)
</span><span>    </span><span style="color:#96b5b4;">set</span><span>(</span><span style="color:#bf616a;">QLIBDIR </span><span>&quot;</span><span style="color:#a3be8c;">/Users/tang/Qt/5.9.7/clang_64/lib</span><span>&quot; )
</span><span style="color:#b48ead;">endif</span><span>(APPLE)
</span><span>
</span><span style="color:#96b5b4;">project</span><span>(qttest)
</span><span>
</span><span style="color:#a7adba;"># 查找QtWidgets包
</span><span style="color:#96b5b4;">find_package</span><span>(Qt5Widgets)
</span><span>
</span><span style="color:#a7adba;">#从ui文件创建cpp代码
</span><span style="color:#bf616a;">qt5_wrap_ui</span><span>(ui_qttest.h qttest.ui)
</span><span>
</span><span style="color:#96b5b4;">add_executable</span><span>(qttest main.cpp qttest.cpp qttest.ui)
</span><span style="color:#96b5b4;">target_link_libraries</span><span>( qttest Qt5::Widgets )
</span></code></pre>
<br>
</li>
</ol>
<h1 id="配置CLion"><a class="zola-anchor" href="#配置CLion"  aria-label="Anchor link for: 配置CLion">⋅ </a>配置CLion</h1>
<ol>
<li>进入 <strong>Preferences/Build,Execution,Deployment/Toolchains</strong> 页面<br />
<br></li>
<li>选择 <strong>Remote Host</strong> 选项<br />
<br></li>
<li>增加一个工具链并配置目标系统登录选项 <strong>Credentials</strong> <img src="https://engtang.net/macOS%E4%B8%8B%E4%BD%BF%E7%94%A8CLion%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95Linux%E4%B8%8A%E7%9A%84QtGUI%E7%A8%8B%E5%BA%8F/clion-toolchains.jpg" alt="" /><br />
<br></li>
<li>然后配置工具链路径,配置完成后如图所示 <img src="https://engtang.net/macOS%E4%B8%8B%E4%BD%BF%E7%94%A8CLion%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95Linux%E4%B8%8A%E7%9A%84QtGUI%E7%A8%8B%E5%BA%8F/clion-toolchains-successful.jpg" alt="" /><br />
<br></li>
<li>进入 <strong>Preferences/Build,Execution,Deployment/CMake</strong> 页面<br />
<br></li>
<li>添加一个配置, <strong>Toolchain</strong> 选项要选择之前配置的远程工具链 <img src="https://engtang.net/macOS%E4%B8%8B%E4%BD%BF%E7%94%A8CLion%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95Linux%E4%B8%8A%E7%9A%84QtGUI%E7%A8%8B%E5%BA%8F/clion-cmake.jpg" alt="" /> 
<br></li>
<li>在macOS启动XQuartz程序,然后在终端下使用 <code>ssh -X ubuntu@192.168.56.101</code> 命令登录Ubuntu系统<br />
<br></li>
<li>登陆后,使用 <code>echo $DISPLAY</code> 命令查看 X11 服务器的转发地址,我的地址为 &quot;localhost:10.0&quot;<br />
<br></li>
<li>在CLion下,进入项目配置页面 <img src="https:&#x2F;&#x2F;engtang.net&#x2F;processed_images&#x2F;a8bf93a8e09279cf00.jpg" />
<br></li>
<li>编辑 <strong>Environment variables</strong> ,新增 DISPLAY 变量 <img src="https:&#x2F;&#x2F;engtang.net&#x2F;processed_images&#x2F;ec0300239095d85800.jpg" />
<br></li>
</ol>
<h1 id="编译并运行程序"><a class="zola-anchor" href="#编译并运行程序"  aria-label="Anchor link for: 编译并运行程序">⋅ </a>编译并运行程序</h1>
<p>配置都完成后,就可以编译程序了. 编译完成后的运行效果如图</p>
<img src="https:&#x2F;&#x2F;engtang.net&#x2F;processed_images&#x2F;6748d101ba81115b00.jpg" />
<br>
<p>如果程序启动失败,控制台输出</p>
<pre style="background-color:#eff1f5;color:#4f5b66;"><code><span>qt.qpa.screen: QXcbConnection: Could not connect to display localhost:10.0
</span><span>Could not connect to any X display.
</span><span>
</span><span>Process finished with exit code 1
</span></code></pre>
<p>那是因为X11 Server 连接已经断开,使用 <code>ssh -X ubuntu@192.168.56.101</code> 命令重新登录Ubuntu即可解决.</p>

  </div>

	

  <div class="pagination">
  	
		<a href="#" class="top">Top</a>
		<a href="https://engtang.net/Windows中使用Qt5.9.0静态库构建应用/" class="right arrow">&#8594;</a>
  </div>

  </main>

  
  <footer>
    <span>&copy; <time datetime="2021-09-08T22:47:23.882479+08:00">2017-2021</time> sanri. Made with <a href="https://www.getzola.org">Zola</a> with <a href="https://github.com/aaranxu/tale-zola">Tala-Zola</a> theme.</span>
  </footer>
  
</body>
</html>
